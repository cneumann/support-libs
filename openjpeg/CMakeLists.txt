
CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

IF(OPENJPEG_SRC_DIR)

    # sanity check OPENJPEG_SRC_DIR
    IF(NOT EXISTS "${OPENJPEG_SRC_DIR}/libopenjpeg/openjpeg.h")
        MESSAGE(SEND_ERROR "No file 'libopenjpeg/openjpeg.h' in OPENJPEG_SRC_DIR = '${OPENJPEG_SRC_DIR}'")
        RETURN()
    ENDIF(NOT EXISTS "${OPENJPEG_SRC_DIR}/libopenjpeg/openjpeg.h")

    IF(SEPARATE_INSTALL_DIRS)
        MESSAGE(STATUS "Using separate install dirs")
        SET(OPENJPEG_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}/openjpeg")
    ELSE(SEPARATE_INSTALL_DIRS)
        MESSAGE(STATUS "Using shared install dir")
        SET(OPENJPEG_INSTALL_PREFIX "${CMAKE_INSTALL_PREFIX}")
    ENDIF(SEPARATE_INSTALL_DIRS)

    IF(BUILD_SHARED_LIBS)
        EXECUTE_PROCESS(
            COMMAND "${CMAKE_COMMAND}"
            "-DCMAKE_INSTALL_PREFIX=${OPENJPEG_INSTALL_PREFIX}"
            "-DBUILD_SHARED_LIBS=ON" "${OPENJPEG_SRC_DIR}"
            WORKING_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}")
    ELSE(BUILD_SHARED_LIBS)
        # EXECUTE_PROCESS(
        #     COMMAND "${CMAKE_COMMAND}"
        #     "-DCMAKE_INSTALL_PREFIX=${OPENJPEG_INSTALL_PREFIX}"
        #     "-DBUILD_SHARED_LIBS=OFF" "${OPENJPEG_SRC_DIR}")
    ENDIF(BUILD_SHARED_LIBS)

ELSE(OPENJPEG_SRC_DIR)
    MESSAGE(STATUS "OPENJPEG_SRC_DIR not set - can not build openjpeg")
ENDIF(OPENJPEG_SRC_DIR)